<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reaction Time Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f9;
            padding: 20px;
        }

        #game-area {
            width: 300px;
            height: 300px;
            margin: 30px auto;
            background-color: #ff9800; /* Initial color: Orange */
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.1s;
            user-select: none; /* Prevents text selection on click */
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* Class for the 'wait' state */
        .waiting {
            background-color: #ff9800 !important; /* Orange */
        }

        /* Class for the 'click now' state */
        .clickable {
            background-color: #4CAF50 !important; /* Green */
        }

        #game-area p {
            padding: 5px;
            margin: 0;
            line-height: 1.3;
        }

        #result {
            margin: 20px 0;
            font-size: 1.1em;
        }

        #time-display, #best-time {
            font-weight: bold;
            color: #333;
        }

        #start-button {
            padding: 10px 20px;
            font-size: 1.1em;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.2s;
        }

        #start-button:disabled {
            background-color: #aaa;
            cursor: default;
        }

        #start-button:hover:not(:disabled) {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>Reaction Time Test</h1>
    <div id="game-area">
        <p>Click inside the box as soon as it turns **green**!</p>
        <p>Your fastest time will be recorded.</p>
    </div>

    <div id="result">
        <p>Your Reaction Time: <span id="time-display">--</span></p>
        <p>Best Time: <span id="best-time">--</span></p>
    </div>

    <button id="start-button">Start Test</button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const gameArea = document.getElementById('game-area');
            const timeDisplay = document.getElementById('time-display');
            const bestTimeDisplay = document.getElementById('best-time');
            const startButton = document.getElementById('start-button');
            const initialText = gameArea.innerHTML;

            let startTime;
            let timeoutId;
            let isWaiting = false;
            let isClickable = false;
            // Use localStorage to save the best score
            let bestTime = localStorage.getItem('bestTime') || '--';

            // Initialize best time display from localStorage
            bestTimeDisplay.textContent = bestTime !== '--' ? `${bestTime} ms` : '--';

            /**
             * Resets the game state and displays a 'Get Ready' message.
             */
            function resetGame() {
                clearTimeout(timeoutId);
                isWaiting = true;
                isClickable = false;
                gameArea.innerHTML = "<p>Wait for **green**...</p><p>Don't click yet!</p>";
                gameArea.classList.remove('clickable');
                gameArea.classList.add('waiting');
                timeDisplay.textContent = '--';
                startButton.disabled = true;
                startButton.textContent = 'Wait...';
            }

            /**
             * Changes the box to green, starts the timer, and makes the box clickable.
             */
            function makeClickable() {
                startTime = new Date().getTime();
                isWaiting = false;
                isClickable = true;
                gameArea.classList.remove('waiting');
                gameArea.classList.add('clickable');
                gameArea.innerHTML = "<p>Click **NOW**!</p>";
                startButton.textContent = 'Test in Progress...';
            }

            /**
             * Starts the test by setting a random delay before turning green.
             */
            function startTest() {
                resetGame();

                // Get a random delay between 1500ms (1.5s) and 4000ms (4s)
                const delay = Math.random() * 2500 + 1500; 

                // Set a timeout to change the color
                timeoutId = setTimeout(makeClickable, delay);
            }

            /**
             * Handles the user's click on the game area.
             */
            function handleGameAreaClick() {
                if (isClickable) {
                    // Success: Calculate and display reaction time
                    const endTime = new Date().getTime();
                    const reactionTime = endTime - startTime;
                    timeDisplay.textContent = `${reactionTime} ms`;

                    // Update best time
                    if (bestTime === '--' || reactionTime < parseFloat(bestTime)) {
                        bestTime = reactionTime.toString();
                        bestTimeDisplay.textContent = `${bestTime} ms`;
                        localStorage.setItem('bestTime', bestTime);
                    }

                    // Reset for the next round
                    gameArea.classList.remove('clickable');
                    gameArea.classList.add('waiting');
                    gameArea.innerHTML = "<p>Time: " + reactionTime + " ms</p><p>Click Start for next round!</p>";
                    isClickable = false;
                    startButton.disabled = false;
                    startButton.textContent = 'Start Test';

                } else if (isWaiting) {
                    // Failure: Clicked too early
                    clearTimeout(timeoutId); // Stop the delayed green change
                    
                    gameArea.classList.remove('waiting');
                    gameArea.innerHTML = "<p>Too soon!</p><p>Click Start to try again.</p>";
                    timeDisplay.textContent = 'Failed';
                    isWaiting = false;
                    startButton.disabled = false;
                    startButton.textContent = 'Start Test';

                    // Briefly show a negative visual cue (like red, though we use orange/green classes)
                    // We'll just rely on the 'Too soon!' message and the orange color.
                }
                // If not isClickable and not isWaiting, nothing happens (initial state)
            }

            // --- Event Listeners ---
            startButton.addEventListener('click', startTest);
            gameArea.addEventListener('mousedown', handleGameAreaClick); 
            
            // Set initial text on game area
            gameArea.innerHTML = initialText;
        });
    </script>
</body>
</html>
